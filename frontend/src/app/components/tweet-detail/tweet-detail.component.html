<div class="tweet-detail-container">
  <div class="header">
    <button class="back-btn" (click)="goBack()">æˆ»ã‚‹</button>
    <h1>ãƒ„ã‚¤ãƒ¼ãƒˆ</h1>
  </div>

  <div class="error-message" *ngIf="errorMessage">
    {{ errorMessage }}
  </div>

  <div class="loading" *ngIf="isLoading">
    èª­ã¿è¾¼ã¿ä¸­...
  </div>

  <!-- ãƒ„ã‚¤ãƒ¼ãƒˆè©³ç´° -->
  <div class="tweet-detail" *ngIf="tweet">
    <div class="avatar">{{ tweet.user_name.charAt(0) }}</div>
    <div class="tweet-content">
      <div class="tweet-header">
        <span class="user_name">{{ tweet.user_name }}</span>
        <span class="user-id">{{ tweet.user_id }}</span>
        <span class="timestamp">Â· {{ tweet.created_at | date:'medium' }}</span>
      </div>
      <div class="tweet-body">
        {{ tweet.tweet_content }}
      </div>
      <div class="tweet-stats">
        <span class="stat"><strong>{{ tweet.replies_count || 0 }}</strong> è¿”ä¿¡</span>
        <span class="stat"><strong>{{ tweet.retweet_count }}</strong> ãƒªãƒ„ã‚¤ãƒ¼ãƒˆ</span>
        <span class="stat"><strong>{{ tweet.like_count }}</strong> ã„ã„ã­</span>
      </div>
      <div class="tweet-actions">
        <button class="action-btn reply-btn" title="è¿”ä¿¡">
          <span class="icon">ğŸ’¬</span>
        </button>
        <button class="action-btn retweet-btn" [class.active]="tweet.is_retweeted" (click)="retweetTweet(tweet)" title="ãƒªãƒ„ã‚¤ãƒ¼ãƒˆ">
          <span class="icon icon-retweet"></span>
        </button>
        <button class="action-btn like-btn" [class.active]="tweet.is_liked" (click)="likeTweet(tweet)" title="ã„ã„ã­">
          <span class="icon icon-like"></span>
        </button>
        <button class="action-btn bookmark-btn" [class.active]="tweet.is_bookmarked" (click)="bookmarkTweet(tweet)" title="ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯">
          <span class="icon icon-bookmark"></span>
        </button>
      </div>
    </div>
  </div>

  <!-- ãƒªãƒ—ãƒ©ã‚¤æŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ  -->
  <div class="reply-composer" *ngIf="tweet">
    <form [formGroup]="replyForm" (ngSubmit)="postReply()">
      <div class="avatar">{{ user_name.charAt(0) }}</div>
      <div class="compose-area">
        <textarea
          formControlName="reply_content"
          placeholder="è¿”ä¿¡ã‚’ãƒ„ã‚¤ãƒ¼ãƒˆ"
          rows="3"
          maxlength="280"
        ></textarea>
        <div class="compose-footer">
          <div class="char-count" [ngClass]="{'warning': replyForm.get('reply_content')?.value?.length > 260}">
            {{ replyForm.get('reply_content')?.value?.length || 0 }}/280
          </div>
          <button
            type="submit"
            [disabled]="replyForm.invalid || isLoading"
            class="reply-submit-btn"
          >
            {{ isLoading ? 'é€ä¿¡ä¸­...' : 'è¿”ä¿¡ã™ã‚‹' }}
          </button>
        </div>
      </div>
    </form>
  </div>

  <!-- ãƒªãƒ—ãƒ©ã‚¤ä¸€è¦§ -->
  <div class="replies-section" *ngIf="tweet">
    <h3>è¿”ä¿¡</h3>
    
    <div class="no-replies" *ngIf="replies.length === 0 && !isLoading">
      ã¾ã è¿”ä¿¡ãŒã‚ã‚Šã¾ã›ã‚“ã€‚æœ€åˆã®è¿”ä¿¡ã‚’æŠ•ç¨¿ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼
    </div>

    <div class="reply" *ngFor="let reply of replies">
      <div class="avatar">{{ reply.user_name.charAt(0) }}</div>
      <div class="reply-content">
        <div class="reply-header">
          <span class="user_name">{{ reply.user_name }}</span>
          <span class="user-id">{{ reply.user_id }}</span>
          <span class="timestamp">Â· {{ reply.created_at | date:'medium' }}</span>
        </div>
        <div class="reply-body">
          {{ reply.reply_content }}
        </div>
        <div class="reply-actions">
          <button class="action-btn delete-btn" *ngIf="reply.user_id === authService.currentUser?.user_id" (click)="deleteReply(reply)" title="å‰Šé™¤">
            <span class="icon">ğŸ—‘ï¸</span>
          </button>
        </div>
      </div>
    </div>

    <!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ -->
    <div class="pagination" *ngIf="totalReplies > pageSize">
      <button 
        [disabled]="currentPage === 1" 
        (click)="onPageChange(currentPage - 1)"
        class="page-btn"
      >
        å‰ã¸
      </button>
      <span class="page-info">{{ currentPage }} / {{ Math.ceil(totalReplies / pageSize) }}</span>
      <button 
        [disabled]="currentPage >= Math.ceil(totalReplies / pageSize)" 
        (click)="onPageChange(currentPage + 1)"
        class="page-btn"
      >
        æ¬¡ã¸
      </button>
    </div>
  </div>
</div>
